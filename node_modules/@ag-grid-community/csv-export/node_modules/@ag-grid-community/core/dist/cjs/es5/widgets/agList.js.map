{"version":3,"sources":["../../../src/ts/widgets/agList.ts"],"names":[],"mappings":"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","file":"agList.js","sourcesContent":["import { AgAbstractField } from \"./agAbstractField\";\nimport { Component } from \"./component\";\nimport { PostConstruct } from \"../context/context\";\nimport { escapeString } from \"../utils/string\";\nimport { KeyCode } from '../constants/keyCode';\nimport { setAriaPosInSet, setAriaRole, setAriaSelected, setAriaSetSize } from '../utils/aria';\n\nexport interface ListOption {\n    value: string;\n    text?: string;\n}\n\nexport class AgList extends Component {\n    public static EVENT_ITEM_SELECTED = 'selectedItem';\n    private static ACTIVE_CLASS = 'ag-active-item';\n\n    private options: ListOption[] = [];\n    private itemEls: HTMLElement[] = [];\n    private highlightedEl: HTMLElement | null;\n    private value: string | null;\n    private displayValue: string | null;\n\n    constructor(private readonly cssIdentifier = 'default') {\n        super(/* html */`<div class=\"ag-list ag-${cssIdentifier}-list\" role=\"listbox\"></div>`);\n    }\n\n    @PostConstruct\n    private init(): void {\n        this.addManagedListener(this.getGui(), 'keydown', this.handleKeyDown.bind(this));\n    }\n\n    private handleKeyDown(e: KeyboardEvent): void {\n        const key = e.key;\n        switch (key) {\n            case KeyCode.ENTER:\n                if (!this.highlightedEl) {\n                    this.setValue(this.getValue());\n                } else {\n                    const pos = this.itemEls.indexOf(this.highlightedEl);\n                    this.setValueByIndex(pos);\n                }\n                break;\n            case KeyCode.DOWN:\n            case KeyCode.UP:\n                const isDown = key === KeyCode.DOWN;\n                let itemToHighlight: HTMLElement;\n\n                e.preventDefault();\n\n                if (!this.highlightedEl) {\n                    itemToHighlight = this.itemEls[isDown ? 0 : this.itemEls.length - 1];\n                } else {\n                    const currentIdx = this.itemEls.indexOf(this.highlightedEl);\n                    let nextPos = currentIdx + (isDown ? 1 : -1);\n                    nextPos = Math.min(Math.max(nextPos, 0), this.itemEls.length - 1);\n                    itemToHighlight = this.itemEls[nextPos];\n                }\n                this.highlightItem(itemToHighlight);\n                break;\n        }\n    }\n\n    public addOptions(listOptions: ListOption[]): this {\n        listOptions.forEach(listOption => this.addOption(listOption));\n        return this;\n    }\n\n    public addOption(listOption: ListOption): this {\n        const { value, text } = listOption;\n        const sanitisedText = escapeString(text || value);\n\n        this.options.push({ value, text: sanitisedText! });\n        this.renderOption(value, sanitisedText!);\n\n        this.updateIndices();\n\n        return this;\n    }\n\n    private updateIndices(): void {\n        const options = this.getGui().querySelectorAll('.ag-list-item');\n        options.forEach((option: HTMLElement, idx) => {\n            setAriaPosInSet(option, idx + 1);\n            setAriaSetSize(option, options.length);\n        });\n    }\n\n    private renderOption(value: string, text: string): void {\n        const itemEl = document.createElement('div');\n\n        setAriaRole(itemEl, 'option');\n        itemEl.classList.add('ag-list-item', `ag-${this.cssIdentifier}-list-item`);\n        itemEl.innerHTML = `<span>${text}</span>`;\n        itemEl.tabIndex = -1;\n\n        this.itemEls.push(itemEl);\n\n        this.addManagedListener(itemEl, 'mouseover', () => this.highlightItem(itemEl));\n        this.addManagedListener(itemEl, 'mouseleave', () => this.clearHighlighted());\n        this.addManagedListener(itemEl, 'click', () => this.setValue(value));\n\n        this.getGui().appendChild(itemEl);\n    }\n\n    public setValue(value?: string | null, silent?: boolean): this {\n        if (this.value === value) {\n            this.fireItemSelected();\n            return this;\n        }\n\n        if (value == null) {\n            this.reset();\n            return this;\n        }\n\n        const idx = this.options.findIndex(option => option.value === value);\n\n        if (idx !== -1) {\n            const option = this.options[idx];\n\n            this.value = option.value;\n            this.displayValue = option.text != null ? option.text : option.value;\n            this.highlightItem(this.itemEls[idx]);\n\n            if (!silent) {\n                this.fireChangeEvent();\n            }\n        }\n\n        return this;\n    }\n\n    public setValueByIndex(idx: number): this {\n        return this.setValue(this.options[idx].value);\n    }\n\n    public getValue(): string | null {\n        return this.value;\n    }\n\n    public getDisplayValue(): string | null {\n        return this.displayValue;\n    }\n\n    public refreshHighlighted(): void {\n        this.clearHighlighted();\n        const idx = this.options.findIndex(option => option.value === this.value);\n\n        if (idx !== -1) {\n            this.highlightItem(this.itemEls[idx]);\n        }\n    }\n\n    private reset(): void {\n        this.value = null;\n        this.displayValue = null;\n        this.clearHighlighted();\n        this.fireChangeEvent();\n    }\n\n    private highlightItem(el: HTMLElement): void {\n        if (!el.offsetParent) { return; }\n\n        this.clearHighlighted();\n        this.highlightedEl = el;\n\n        this.highlightedEl.classList.add(AgList.ACTIVE_CLASS);\n        setAriaSelected(this.highlightedEl, true);\n\n        this.highlightedEl.focus();\n    }\n\n    private clearHighlighted(): void {\n        if (!this.highlightedEl || !this.highlightedEl.offsetParent) { return; }\n\n        this.highlightedEl.classList.remove(AgList.ACTIVE_CLASS);\n        setAriaSelected(this.highlightedEl, false);\n\n        this.highlightedEl = null;\n    }\n\n    private fireChangeEvent(): void {\n        this.dispatchEvent({ type: AgAbstractField.EVENT_CHANGED });\n        this.fireItemSelected();\n    }\n\n    private fireItemSelected(): void {\n        this.dispatchEvent({ type: AgList.EVENT_ITEM_SELECTED });\n    }\n}\n"]}
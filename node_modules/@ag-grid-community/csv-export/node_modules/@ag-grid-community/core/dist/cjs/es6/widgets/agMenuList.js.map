{"version":3,"sources":["../../../src/ts/widgets/agMenuList.ts"],"names":[],"mappings":"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","file":"agMenuList.js","sourcesContent":["\nimport { FocusService } from \"../focusService\";\nimport { Autowired, PostConstruct } from \"../context/context\";\nimport { AgMenuItemComponent, MenuItemSelectedEvent, MenuItemActivatedEvent } from \"./agMenuItemComponent\";\nimport { TabGuardComp } from \"./tabGuardComp\";\nimport { KeyCode } from \"../constants/keyCode\";\nimport { MenuItemDef } from \"../entities/gridOptions\";\nimport { loadTemplate } from \"../utils/dom\";\nimport { last } from \"../utils/array\";\nimport { setAriaLevel } from \"../utils/aria\";\n\nexport class AgMenuList extends TabGuardComp {\n\n    @Autowired('focusService') private readonly focusService: FocusService;\n\n    private menuItems: AgMenuItemComponent[] = [];\n    private activeMenuItem: AgMenuItemComponent | null;\n\n    constructor(private readonly level = 1) {\n        super(/* html */`<div class=\"ag-menu-list\" role=\"tree\"></div>`);\n    }\n\n    @PostConstruct\n    private postConstruct() {\n        this.initialiseTabGuard({\n            onTabKeyDown: e => this.onTabKeyDown(e),\n            handleKeyDown: e => this.handleKeyDown(e)\n        });\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent) {\n        const parent = this.getParentComponent();\n        const parentGui = parent && parent.getGui();\n        const isManaged = parentGui && parentGui.classList.contains('ag-focus-managed');\n\n        if (!isManaged) {\n            e.preventDefault();\n        }\n\n        if (e.shiftKey) {\n            this.closeIfIsChild(e);\n        }\n    }\n\n    protected handleKeyDown(e: KeyboardEvent): void {\n        switch (e.key) {\n            case KeyCode.UP:\n            case KeyCode.RIGHT:\n            case KeyCode.DOWN:\n            case KeyCode.LEFT:\n                e.preventDefault();\n                this.handleNavKey(e.key);\n                break;\n            case KeyCode.ESCAPE:\n                const topMenu = this.findTopMenu();\n\n                if (topMenu) {\n                    this.focusService.focusInto(topMenu.getGui());\n                }\n\n                break;\n        }\n    }\n\n    public clearActiveItem(): void {\n        if (this.activeMenuItem) {\n            this.activeMenuItem.deactivate();\n            this.activeMenuItem = null;\n        }\n    }\n\n    public addMenuItems(menuItems?: (MenuItemDef | string)[]): void {\n        if (menuItems == null) { return; }\n\n        menuItems.forEach(menuItemOrString => {\n            if (menuItemOrString === 'separator') {\n                this.addSeparator();\n            } else if (typeof menuItemOrString === 'string') {\n                console.warn(`AG Grid: unrecognised menu item ${menuItemOrString}`);\n            } else {\n                this.addItem(menuItemOrString);\n            }\n        });\n    }\n\n    public addItem(menuItemDef: MenuItemDef): void {\n        const menuItem = this.createManagedBean(new AgMenuItemComponent({\n            ...menuItemDef,\n            isAnotherSubMenuOpen: () => this.menuItems.some(m => m.isSubMenuOpen())\n        }));\n\n        menuItem.setParentComponent(this);\n\n        setAriaLevel(menuItem.getGui(), this.level);\n\n        this.menuItems.push(menuItem);\n        this.appendChild(menuItem.getGui());\n\n        this.addManagedListener(menuItem, AgMenuItemComponent.EVENT_MENU_ITEM_SELECTED, (event: MenuItemSelectedEvent) => {\n            this.dispatchEvent(event);\n        });\n\n        this.addManagedListener(menuItem, AgMenuItemComponent.EVENT_MENU_ITEM_ACTIVATED, (event: MenuItemActivatedEvent) => {\n            if (this.activeMenuItem && this.activeMenuItem !== event.menuItem) {\n                this.activeMenuItem.deactivate();\n            }\n\n            this.activeMenuItem = event.menuItem;\n        });\n    }\n\n    public activateFirstItem(): void {\n        const item = this.menuItems.filter(currentItem => !currentItem.isDisabled())[0];\n\n        if (!item) { return; }\n\n        item.activate();\n    }\n\n    private addSeparator() {\n        const separatorHtml = /* html */`\n            <div class=\"ag-menu-separator\" aria-hidden=\"true\">\n                <div class=\"ag-menu-separator-part\"></div>\n                <div class=\"ag-menu-separator-part\"></div>\n                <div class=\"ag-menu-separator-part\"></div>\n                <div class=\"ag-menu-separator-part\"></div>\n            </div>`;\n\n        this.appendChild(loadTemplate(separatorHtml));\n    }\n\n    private findTopMenu(): AgMenuList | undefined {\n        let parent = this.getParentComponent();\n\n        if (!parent && this instanceof AgMenuList) { return this; }\n\n        while (true) {\n            const nextParent = parent && parent.getParentComponent && parent.getParentComponent();\n\n            if (!nextParent || (!(nextParent instanceof AgMenuList || nextParent instanceof AgMenuItemComponent))) {\n                break;\n            }\n\n            parent = nextParent;\n        }\n\n        return parent instanceof AgMenuList ? parent : undefined;\n    }\n\n    private handleNavKey(key: string): void {\n        switch (key) {\n            case KeyCode.UP:\n            case KeyCode.DOWN:\n                const nextItem = this.findNextItem(key === KeyCode.UP);\n\n                if (nextItem && nextItem !== this.activeMenuItem) {\n                    nextItem.activate();\n                }\n\n                return;\n        }\n\n        const left = this.gridOptionsWrapper.isEnableRtl() ? KeyCode.RIGHT : KeyCode.LEFT;\n\n        if (key === left) {\n            this.closeIfIsChild();\n        } else {\n            this.openChild();\n        }\n    }\n\n    private closeIfIsChild(e?: KeyboardEvent): void {\n        const parentItem = this.getParentComponent();\n\n        if (parentItem && parentItem instanceof AgMenuItemComponent) {\n            if (e) { e.preventDefault(); }\n\n            parentItem.closeSubMenu();\n            parentItem.getGui().focus();\n        }\n    }\n\n    private openChild(): void {\n        if (this.activeMenuItem) {\n            this.activeMenuItem.openSubMenu(true);\n        }\n    }\n\n    private findNextItem(up?: boolean): AgMenuItemComponent | undefined {\n        const items = this.menuItems.filter(item => !item.isDisabled());\n\n        if (!items.length) { return; }\n\n        if (!this.activeMenuItem) {\n            return up ? last(items) : items[0];\n        }\n\n        if (up) {\n            items.reverse();\n        }\n\n        let nextItem: AgMenuItemComponent;\n        let foundCurrent = false;\n\n        for (let i = 0; i < items.length; i++) {\n            const item = items[i];\n\n            if (!foundCurrent) {\n                if (item === this.activeMenuItem) {\n                    foundCurrent = true;\n                }\n                continue;\n            }\n\n            nextItem = item;\n            break;\n        }\n\n        return nextItem! || this.activeMenuItem;\n    }\n\n    protected destroy(): void {\n        this.clearActiveItem();\n        super.destroy();\n    }\n}\n"]}
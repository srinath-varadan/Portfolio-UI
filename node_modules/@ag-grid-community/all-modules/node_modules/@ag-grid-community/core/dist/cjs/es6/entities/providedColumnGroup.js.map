{"version":3,"sources":["../../../src/ts/entities/providedColumnGroup.ts"],"names":[],"mappings":"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","file":"providedColumnGroup.js","sourcesContent":["import { IProvidedColumn } from \"./iProvidedColumn\";\nimport { ColGroupDef } from \"./colDef\";\nimport { ColumnGroup } from \"./columnGroup\";\nimport { Column } from \"./column\";\nimport { EventService } from \"../eventService\";\nimport { IEventEmitter } from \"../interfaces/iEventEmitter\";\nimport { AgEvent } from \"../events\";\n\nexport class ProvidedColumnGroup implements IProvidedColumn, IEventEmitter {\n\n    public static EVENT_EXPANDED_CHANGED = 'expandedChanged';\n    public static EVENT_EXPANDABLE_CHANGED = 'expandableChanged';\n\n    private localEventService = new EventService();\n\n    private colGroupDef: ColGroupDef | null;\n    private originalParent: ProvidedColumnGroup | null;\n\n    private children: IProvidedColumn[];\n    private groupId: string;\n    private expandable = false;\n\n    private expanded: boolean;\n    private padding: boolean;\n\n    private level: number;\n\n    constructor(colGroupDef: ColGroupDef | null, groupId: string, padding: boolean, level: number) {\n        this.colGroupDef = colGroupDef;\n        this.groupId = groupId;\n        this.expanded = !!colGroupDef && !!colGroupDef.openByDefault;\n        this.padding = padding;\n        this.level = level;\n    }\n\n    public setOriginalParent(originalParent: ProvidedColumnGroup | null): void {\n        this.originalParent = originalParent;\n    }\n\n    public getOriginalParent(): ProvidedColumnGroup | null {\n        return this.originalParent;\n    }\n\n    public getLevel(): number {\n        return this.level;\n    }\n\n    public isVisible(): boolean {\n        // return true if at least one child is visible\n        if (this.children) {\n            return this.children.some(child => child.isVisible());\n        }\n\n        return false;\n    }\n\n    public isPadding(): boolean {\n        return this.padding;\n    }\n\n    public setExpanded(expanded: boolean | undefined): void {\n        this.expanded = expanded === undefined ? false : expanded;\n        const event: AgEvent = {\n            type: ProvidedColumnGroup.EVENT_EXPANDED_CHANGED\n        };\n        this.localEventService.dispatchEvent(event);\n    }\n\n    public isExpandable(): boolean {\n        return this.expandable;\n    }\n\n    public isExpanded(): boolean {\n        return this.expanded;\n    }\n\n    public getGroupId(): string {\n        return this.groupId;\n    }\n\n    public getId(): string {\n        return this.getGroupId();\n    }\n\n    public setChildren(children: IProvidedColumn[]): void {\n        this.children = children;\n    }\n\n    public getChildren(): IProvidedColumn[] {\n        return this.children;\n    }\n\n    public getColGroupDef(): ColGroupDef | null {\n        return this.colGroupDef;\n    }\n\n    public getLeafColumns(): Column[] {\n        const result: Column[] = [];\n        this.addLeafColumns(result);\n        return result;\n    }\n\n    private addLeafColumns(leafColumns: Column[]): void {\n        if (!this.children) { return; }\n\n        this.children.forEach((child: IProvidedColumn) => {\n            if (child instanceof Column) {\n                leafColumns.push(child);\n            } else if (child instanceof ProvidedColumnGroup) {\n                child.addLeafColumns(leafColumns);\n            }\n        });\n    }\n\n    public getColumnGroupShow(): string | undefined {\n        const colGroupDef = this.colGroupDef;\n\n        if (!colGroupDef) { return; }\n\n        return colGroupDef.columnGroupShow;\n    }\n\n    // need to check that this group has at least one col showing when both expanded and contracted.\n    // if not, then we don't allow expanding and contracting on this group\n\n    public setupExpandable() {\n        this.setExpandable();\n        // note - we should be removing this event listener\n        this.getLeafColumns().forEach(col => col.addEventListener(Column.EVENT_VISIBLE_CHANGED, this.onColumnVisibilityChanged.bind(this)));\n    }\n\n    public setExpandable() {\n        if (this.isPadding()) { return; }\n        // want to make sure the group doesn't disappear when it's open\n        let atLeastOneShowingWhenOpen = false;\n        // want to make sure the group doesn't disappear when it's closed\n        let atLeastOneShowingWhenClosed = false;\n        // want to make sure the group has something to show / hide\n        let atLeastOneChangeable = false;\n\n        const children = this.findChildrenRemovingPadding();\n\n        for (let i = 0, j = children.length; i < j; i++) {\n            const abstractColumn = children[i];\n            if (!abstractColumn.isVisible()) {\n                continue;\n            }\n            // if the abstractColumn is a grid generated group, there will be no colDef\n            const headerGroupShow = abstractColumn.getColumnGroupShow();\n\n            if (headerGroupShow === ColumnGroup.HEADER_GROUP_SHOW_OPEN) {\n                atLeastOneShowingWhenOpen = true;\n                atLeastOneChangeable = true;\n            } else if (headerGroupShow === ColumnGroup.HEADER_GROUP_SHOW_CLOSED) {\n                atLeastOneShowingWhenClosed = true;\n                atLeastOneChangeable = true;\n            } else {\n                atLeastOneShowingWhenOpen = true;\n                atLeastOneShowingWhenClosed = true;\n            }\n        }\n\n        const expandable = atLeastOneShowingWhenOpen && atLeastOneShowingWhenClosed && atLeastOneChangeable;\n\n        if (this.expandable !== expandable) {\n            this.expandable = expandable;\n            const event: AgEvent = {\n                type: ProvidedColumnGroup.EVENT_EXPANDABLE_CHANGED\n            };\n            this.localEventService.dispatchEvent(event);\n        }\n    }\n\n    private findChildrenRemovingPadding(): IProvidedColumn[] {\n        const res: IProvidedColumn[] = [];\n\n        const process = (items: IProvidedColumn[]) => {\n            items.forEach(item => {\n                // if padding, we add this children instead of the padding\n                const skipBecausePadding = item instanceof ProvidedColumnGroup && item.isPadding();\n                if (skipBecausePadding) {\n                    process((item as ProvidedColumnGroup).children);\n                } else {\n                    res.push(item);\n                }\n            });\n        };\n\n        process(this.children);\n\n        return res;\n    }\n\n    private onColumnVisibilityChanged(): void {\n        this.setExpandable();\n    }\n\n    public addEventListener(eventType: string, listener: Function): void {\n        this.localEventService.addEventListener(eventType, listener);\n    }\n\n    public removeEventListener(eventType: string, listener: Function): void {\n        this.localEventService.removeEventListener(eventType, listener);\n    }\n}\n"]}
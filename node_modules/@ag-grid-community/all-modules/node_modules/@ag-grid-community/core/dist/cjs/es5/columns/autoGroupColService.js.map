{"version":3,"sources":["../../../src/ts/columns/autoGroupColService.ts"],"names":[],"mappings":"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","file":"autoGroupColService.js","sourcesContent":["import { Autowired, Bean } from \"../context/context\";\nimport { Column } from \"../entities/column\";\nimport { ColDef } from \"../entities/colDef\";\nimport { ColumnModel } from \"./columnModel\";\nimport { ColumnFactory } from \"./columnFactory\";\nimport { Constants } from \"../constants/constants\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { mergeDeep } from \"../utils/object\";\nimport { missing } from \"../utils/generic\";\n\n@Bean('autoGroupColService')\nexport class AutoGroupColService extends BeanStub {\n\n    public static GROUP_AUTO_COLUMN_BUNDLE_ID = Constants.GROUP_AUTO_COLUMN_ID;\n\n    @Autowired('columnModel') private columnModel: ColumnModel;\n    @Autowired('columnFactory') private columnFactory: ColumnFactory;\n\n    public createAutoGroupColumns(existingCols: Column[], rowGroupColumns: Column[]): Column[] {\n        const groupAutoColumns: Column[] = [];\n\n        const doingTreeData = this.gridOptionsWrapper.isTreeData();\n        let doingMultiAutoColumn = this.gridOptionsWrapper.isGroupMultiAutoColumn();\n\n        if (doingTreeData && doingMultiAutoColumn) {\n            console.warn('AG Grid: you cannot mix groupMultiAutoColumn with treeData, only one column can be used to display groups when doing tree data');\n            doingMultiAutoColumn = false;\n        }\n\n        // if doing groupMultiAutoColumn, then we call the method multiple times, once\n        // for each column we are grouping by\n        if (doingMultiAutoColumn) {\n            rowGroupColumns.forEach((rowGroupCol: Column, index: number) => {\n                groupAutoColumns.push(this.createOneAutoGroupColumn(existingCols, rowGroupCol, index));\n            });\n        } else {\n            groupAutoColumns.push(this.createOneAutoGroupColumn(existingCols));\n        }\n\n        return groupAutoColumns;\n    }\n\n    // rowGroupCol and index are missing if groupMultiAutoColumn=false\n    private createOneAutoGroupColumn(existingCols: Column[], rowGroupCol?: Column, index?: number): Column {\n        // if one provided by user, use it, otherwise create one\n        let defaultAutoColDef: ColDef = this.generateDefaultColDef(rowGroupCol);\n        // if doing multi, set the field\n        let colId: string;\n        if (rowGroupCol) {\n            colId = `${Constants.GROUP_AUTO_COLUMN_ID}-${rowGroupCol.getId()}`;\n        } else {\n            colId = AutoGroupColService.GROUP_AUTO_COLUMN_BUNDLE_ID;\n        }\n\n        const userAutoColDef = this.gridOptionsWrapper.getAutoGroupColumnDef();\n        mergeDeep(defaultAutoColDef, userAutoColDef);\n\n        defaultAutoColDef = this.columnFactory.mergeColDefs(defaultAutoColDef);\n\n        defaultAutoColDef.colId = colId;\n\n        // For tree data the filter is always allowed\n        if (!this.gridOptionsWrapper.isTreeData()) {\n            // we would only allow filter if the user has provided field or value getter. otherwise the filter\n            // would not be able to work.\n            const noFieldOrValueGetter = missing(defaultAutoColDef.field) && missing(defaultAutoColDef.valueGetter) && missing(defaultAutoColDef.filterValueGetter);\n            if (noFieldOrValueGetter) {\n                defaultAutoColDef.filter = false;\n            }\n        }\n\n        // if showing many cols, we don't want to show more than one with a checkbox for selection\n        if (index && index > 0) {\n            defaultAutoColDef.headerCheckboxSelection = false;\n        }\n\n        const existingCol = existingCols.find( col => col.getId()==colId );\n\n        if (existingCol) {\n            existingCol.setColDef(defaultAutoColDef, null);\n            this.columnFactory.applyColumnState(existingCol, defaultAutoColDef);\n            return existingCol;\n        }\n\n        const newCol = new Column(defaultAutoColDef, null, colId, true);\n        this.context.createBean(newCol);\n        return newCol;\n    }\n\n    private generateDefaultColDef(rowGroupCol?: Column): ColDef {\n        const userDef = this.gridOptionsWrapper.getAutoGroupColumnDef();\n        const localeTextFunc = this.gridOptionsWrapper.getLocaleTextFunc();\n\n        const res: ColDef = {\n            headerName: localeTextFunc('group', 'Group')\n        };\n\n        const userHasProvidedGroupCellRenderer =\n            userDef &&\n            (userDef.cellRenderer || userDef.cellRendererFramework || userDef.cellRendererSelector);\n\n        // only add the default group cell renderer if user hasn't provided one\n        if (!userHasProvidedGroupCellRenderer) {\n            res.cellRenderer = 'agGroupCellRenderer';\n        }\n\n        // we never allow moving the group column\n        // defaultAutoColDef.suppressMovable = true;\n\n        if (rowGroupCol) {\n            const colDef = rowGroupCol.getColDef();\n            Object.assign(res, {\n                // cellRendererParams.groupKey: colDefToCopy.field;\n                headerName: this.columnModel.getDisplayNameForColumn(rowGroupCol, 'header'),\n                headerValueGetter: colDef.headerValueGetter\n            });\n\n            if (colDef.cellRenderer || colDef.cellRendererFramework) {\n                Object.assign(res, {\n                    cellRendererParams: {\n                        innerRenderer: colDef.cellRenderer,\n                        innerRendererFramework: colDef.cellRendererFramework,\n                        innerRendererParams: colDef.cellRendererParams\n                    }\n                });\n            }\n            res.showRowGroup = rowGroupCol.getColId();\n        } else {\n            res.showRowGroup = true;\n        }\n\n        return res;\n    }\n\n}\n"]}
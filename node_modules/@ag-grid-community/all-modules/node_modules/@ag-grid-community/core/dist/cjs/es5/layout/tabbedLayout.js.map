{"version":3,"sources":["../../../src/ts/layout/tabbedLayout.ts"],"names":[],"mappings":"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","file":"tabbedLayout.js","sourcesContent":["import { AgPromise } from '../utils';\nimport { RefSelector } from '../widgets/componentAnnotations';\nimport { ManagedFocusFeature } from '../widgets/managedFocusFeature';\nimport { IAfterGuiAttachedParams } from '../interfaces/iAfterGuiAttachedParams';\nimport { clearElement } from '../utils/dom';\nimport { setAriaLabel, setAriaRole } from '../utils/aria';\nimport { callIfPresent } from '../utils/function';\nimport { KeyCode } from '../constants/keyCode';\nimport { Component } from '../widgets/component';\nimport { PostConstruct, Autowired } from '../context/context';\nimport { FocusService } from '../focusService';\n\nexport class TabbedLayout extends Component {\n\n    @Autowired('focusService') private focusService: FocusService;\n\n    @RefSelector('eHeader') private readonly eHeader: HTMLElement;\n    @RefSelector('eBody') private readonly eBody: HTMLElement;\n\n    private params: TabbedLayoutParams;\n    private afterAttachedParams: IAfterGuiAttachedParams;\n    private items: TabbedItemWrapper[] = [];\n    private activeItem: TabbedItemWrapper;\n    private lastScrollListener: (() => null) | null | undefined;\n    private readonly tabbedItemScrollMap = new Map<string, number>();\n\n    constructor(params: TabbedLayoutParams) {\n        super(TabbedLayout.getTemplate(params.cssClass));\n        this.params = params;\n\n        if (params.items) {\n            params.items.forEach(item => this.addItem(item));\n        }\n    }\n\n    @PostConstruct\n    private postConstruct() {\n        this.createManagedBean(new ManagedFocusFeature(\n            this.getFocusableElement(),\n            {\n                onTabKeyDown: this.onTabKeyDown.bind(this),\n                handleKeyDown: this.handleKeyDown.bind(this)\n            }\n        ));\n    }\n\n    private static getTemplate(cssClass?: string) {\n        return /* html */ `<div class=\"ag-tabs ${cssClass}\">\n            <div ref=\"eHeader\" role=\"tablist\" class=\"ag-tabs-header ${cssClass ? `${cssClass}-header` : ''}\"></div>\n            <div ref=\"eBody\" role=\"presentation\" class=\"ag-tabs-body ${cssClass ? `${cssClass}-body` : ''}\"></div>\n        </div>`;\n    }\n\n    protected handleKeyDown(e: KeyboardEvent): void {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        switch (e.key) {\n            case KeyCode.RIGHT:\n            case KeyCode.LEFT:\n                if (!this.eHeader.contains(eDocument.activeElement)) { return; }\n\n                const currentPosition = this.items.indexOf(this.activeItem);\n                const nextPosition = e.key === KeyCode.RIGHT ? Math.min(currentPosition + 1, this.items.length - 1) : Math.max(currentPosition - 1, 0);\n\n                if (currentPosition === nextPosition) { return; }\n\n                e.preventDefault();\n\n                const nextItem = this.items[nextPosition];\n\n                this.showItemWrapper(nextItem);\n                nextItem.eHeaderButton.focus();\n                break;\n            case KeyCode.UP:\n            case KeyCode.DOWN:\n                e.stopPropagation();\n                break;\n        }\n    }\n\n    protected onTabKeyDown(e: KeyboardEvent) {\n        if (e.defaultPrevented) { return; }\n\n        const { focusService, eHeader, eBody, activeItem } = this;\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const activeElement = eDocument.activeElement as HTMLElement;\n\n        e.preventDefault();\n\n        if (eHeader.contains(activeElement)) {\n            // focus is in header, move into body of popup\n            focusService.focusInto(eBody, e.shiftKey);\n        } else {\n            // focus is in body, establish if it should return to header\n            if (focusService.isFocusUnderManagedComponent(eBody)) {\n                // focus was in a managed focus component and has now left, so we can return to the header\n                activeItem.eHeaderButton.focus();\n            } else {\n                const nextEl = focusService.findNextFocusableElement(eBody, false, e.shiftKey);\n\n                if (nextEl) {\n                    // if another element exists in the body that can be focussed, go to that\n                    nextEl.focus();\n                } else {\n                    // otherwise return to the header\n                    activeItem.eHeaderButton.focus();\n                }\n            }\n        }\n    }\n\n    public setAfterAttachedParams(params: IAfterGuiAttachedParams): void {\n        this.afterAttachedParams = params;\n    }\n\n    public showFirstItem(): void {\n        if (this.items.length > 0) {\n            this.showItemWrapper(this.items[0]);\n        }\n    }\n\n    private addItem(item: TabbedItem): void {\n        const eHeaderButton = document.createElement('span');\n\n        setAriaRole(eHeaderButton, 'tab');\n        eHeaderButton.setAttribute('tabIndex', '-1');\n        eHeaderButton.appendChild(item.title);\n        eHeaderButton.classList.add('ag-tab');\n\n        this.eHeader.appendChild(eHeaderButton);\n        setAriaLabel(eHeaderButton, item.titleLabel);\n\n        const wrapper: TabbedItemWrapper = {\n            tabbedItem: item,\n            eHeaderButton: eHeaderButton\n        };\n        this.items.push(wrapper);\n\n        eHeaderButton.addEventListener('click', this.showItemWrapper.bind(this, wrapper));\n    }\n\n    public showItem(tabbedItem: TabbedItem): void {\n        const itemWrapper = this.items.find(wrapper => wrapper.tabbedItem === tabbedItem);\n\n        if (itemWrapper) {\n            this.showItemWrapper(itemWrapper);\n        }\n    }\n\n    private showItemWrapper(wrapper: TabbedItemWrapper): void {\n        const { tabbedItem, eHeaderButton } = wrapper;\n\n        if (this.params.onItemClicked) {\n            this.params.onItemClicked({ item: tabbedItem });\n        }\n\n        if (this.activeItem === wrapper) {\n            callIfPresent(this.params.onActiveItemClicked!);\n            return;\n        }\n\n        if (this.lastScrollListener) {\n            this.lastScrollListener = this.lastScrollListener();\n        }\n\n        clearElement(this.eBody);\n\n        tabbedItem.bodyPromise.then((body: HTMLElement) => {\n            this.eBody.appendChild(body);\n            const onlyUnmanaged = !this.focusService.isKeyboardMode();\n\n            this.focusService.focusInto(this.eBody, false, onlyUnmanaged);\n\n            if (tabbedItem.afterAttachedCallback) {\n                tabbedItem.afterAttachedCallback(this.afterAttachedParams);\n            }\n\n            if (this.params.keepScrollPosition) {\n                const scrollableContainer = (tabbedItem.getScrollableContainer && tabbedItem.getScrollableContainer()) || body;\n                this.lastScrollListener = this.addManagedListener(scrollableContainer, 'scroll', () => {\n                    this.tabbedItemScrollMap.set(tabbedItem.name, scrollableContainer.scrollTop);\n                });\n                const scrollPosition = this.tabbedItemScrollMap.get(tabbedItem.name);\n                if (scrollPosition !== undefined) {\n                    // Safari needs a small timeout or it will fire a scroll event to position 0\n                    setTimeout(() => {\n                        scrollableContainer.scrollTop = scrollPosition;\n                    }, 0);\n                }\n            }\n        });\n\n        if (this.activeItem) {\n            this.activeItem.eHeaderButton.classList.remove('ag-tab-selected');\n        }\n\n        eHeaderButton.classList.add('ag-tab-selected');\n\n        this.activeItem = wrapper;\n    }\n}\n\nexport interface TabbedLayoutParams {\n    items: TabbedItem[];\n    cssClass?: string;\n    keepScrollPosition?: boolean;\n    onItemClicked?: Function;\n    onActiveItemClicked?: Function;\n}\n\nexport interface TabbedItem {\n    title: Element;\n    titleLabel: string;\n    bodyPromise: AgPromise<HTMLElement>;\n    name: string;\n    getScrollableContainer?: () => HTMLElement;\n    afterAttachedCallback?: (params: IAfterGuiAttachedParams) => void;\n}\n\ninterface TabbedItemWrapper {\n    tabbedItem: TabbedItem;\n    eHeaderButton: HTMLElement;\n}\n"]}
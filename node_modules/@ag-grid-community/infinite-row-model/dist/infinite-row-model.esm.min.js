/**
          * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.3.0
          * @link https://www.ag-grid.com/
          * @license MIT
          */
/**
          * @ag-grid-community/infinite-row-model - Advanced Data Grid / Data Table supporting Javascript / Typescript / React / Angular / Vue * @version v27.3.0
          * @link https://www.ag-grid.com/
          * @license MIT
          */
import{_ as t,RowNode as e,Autowired as o,PostConstruct as r,PreDestroy as n,RowNodeBlock as i,NumberSequence as s,Events as a,Qualifier as c,BeanStub as h,Constants as p,Bean as u,ModuleNames as d}from"@ag-grid-community/core";var f,l=(f=function(t,e){return(f=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(t,e)},function(t,e){function o(){this.constructor=t}f(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}),w=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},g=function(i){function s(t,e,o){var r=i.call(this,t)||this;return r.parentCache=e,r.params=o,r.startRow=t*o.blockSize,r.endRow=r.startRow+o.blockSize,r}return l(s,i),s.prototype.postConstruct=function(){this.createRowNodes()},s.prototype.getBlockStateJson=function(){return{id:""+this.getId(),state:{blockNumber:this.getId(),startRow:this.getStartRow(),endRow:this.getEndRow(),pageStatus:this.getState()}}},s.prototype.setDataAndId=function(e,o,r){!e.id&&e.alreadyRendered&&(e.alreadyRendered=!1),t.exists(o)?e.setDataAndId(o,r.toString()):e.setDataAndId(void 0,void 0)},s.prototype.loadFromDatasource=function(){var e=this,o=this.createLoadParams();t.missing(this.params.datasource.getRows)?console.warn("AG Grid: datasource is missing getRows method"):window.setTimeout((function(){e.params.datasource.getRows(o)}),0)},s.prototype.processServerFail=function(){},s.prototype.createLoadParams=function(){return{startRow:this.getStartRow(),endRow:this.getEndRow(),successCallback:this.pageLoaded.bind(this,this.getVersion()),failCallback:this.pageLoadFailed.bind(this,this.getVersion()),sortModel:this.params.sortModel,filterModel:this.params.filterModel,context:this.gridOptionsWrapper.getContext()}},s.prototype.forEachNode=function(t,e,o){var r=this;this.rowNodes.forEach((function(n,i){r.startRow+i<o&&t(n,e.next())}))},s.prototype.getLastAccessed=function(){return this.lastAccessed},s.prototype.getRow=function(t,e){void 0===e&&(e=!1),e||(this.lastAccessed=this.params.lastAccessedSequence.next());var o=t-this.startRow;return this.rowNodes[o]},s.prototype.getStartRow=function(){return this.startRow},s.prototype.getEndRow=function(){return this.endRow},s.prototype.createRowNodes=function(){this.rowNodes=[];for(var t=0;t<this.params.blockSize;t++){var o=this.startRow+t,r=new e(this.beans);r.setRowHeight(this.params.rowHeight),r.uiLevel=0,r.setRowIndex(o),r.setRowTop(this.params.rowHeight*o),this.rowNodes.push(r)}},s.prototype.processServerResult=function(t){var e=this;this.rowNodes.forEach((function(o,r){var n=t.rowData?t.rowData[r]:void 0;e.setDataAndId(o,n,e.startRow+r)}));var o=null!=t.rowCount&&t.rowCount>=0?t.rowCount:void 0;this.parentCache.pageLoaded(this,o)},s.prototype.destroyRowNodes=function(){this.rowNodes.forEach((function(t){t.clearRowTopAndRowIndex()}))},w([o("beans")],s.prototype,"beans",void 0),w([r],s.prototype,"postConstruct",null),w([n],s.prototype,"destroyRowNodes",null),s}(i),y=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),C=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},R=function(t,e){return function(o,r){e(o,r,t)}},v=function(e){function r(t){var o=e.call(this)||this;return o.lastRowIndexKnown=!1,o.blocks={},o.blockCount=0,o.rowCount=t.initialRowCount,o.params=t,o}return y(r,e),r.prototype.setBeans=function(t){this.logger=t.create("InfiniteCache")},r.prototype.getRow=function(t,e){void 0===e&&(e=!1);var o=Math.floor(t/this.params.blockSize),r=this.blocks[o];if(!r){if(e)return;r=this.createBlock(o)}return r.getRow(t)},r.prototype.createBlock=function(t){var e=this.createBean(new g(t,this,this.params));return this.blocks[e.getId()]=e,this.blockCount++,this.purgeBlocksIfNeeded(e),this.params.rowNodeBlockLoader.addBlock(e),e},r.prototype.refreshCache=function(){0==this.blockCount?this.purgeCache():(this.getBlocksInOrder().forEach((function(t){return t.setStateWaitingToLoad()})),this.params.rowNodeBlockLoader.checkBlockToLoad())},r.prototype.destroyAllBlocks=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.destroyBlock(e)}))},r.prototype.getRowCount=function(){return this.rowCount},r.prototype.isLastRowIndexKnown=function(){return this.lastRowIndexKnown},r.prototype.pageLoaded=function(t,e){this.isAlive()&&(this.logger.log("onPageLoaded: page = "+t.getId()+", lastRow = "+e),this.checkRowCount(t,e),this.onCacheUpdated())},r.prototype.purgeBlocksIfNeeded=function(t){var e=this,o=this.getBlocksInOrder().filter((function(e){return e!=t}));o.sort((function(t,e){return e.getLastAccessed()-t.getLastAccessed()}));var n=this.params.maxBlocksInCache>0,i=n?this.params.maxBlocksInCache-1:null,s=r.MAX_EMPTY_BLOCKS_TO_KEEP-1;o.forEach((function(t,o){if(t.getState()===g.STATE_WAITING_TO_LOAD&&o>=s||!!n&&o>=i){if(e.isBlockCurrentlyDisplayed(t))return;if(e.isBlockFocused(t))return;e.removeBlockFromCache(t)}}))},r.prototype.isBlockFocused=function(t){var e=this.focusService.getFocusCellToUseAfterRefresh();if(!e)return!1;if(null!=e.rowPinned)return!1;var o=t.getStartRow(),r=t.getEndRow();return e.rowIndex>=o&&e.rowIndex<r},r.prototype.isBlockCurrentlyDisplayed=function(t){var e=t.getStartRow(),o=t.getEndRow()-1;return this.rowRenderer.isRangeInRenderedViewport(e,o)},r.prototype.removeBlockFromCache=function(t){t&&this.destroyBlock(t)},r.prototype.checkRowCount=function(t,e){if("number"==typeof e&&e>=0)this.rowCount=e,this.lastRowIndexKnown=!0;else if(!this.lastRowIndexKnown){var o=(t.getId()+1)*this.params.blockSize+this.params.overflowSize;this.rowCount<o&&(this.rowCount=o)}},r.prototype.setRowCount=function(e,o){this.rowCount=e,t.exists(o)&&(this.lastRowIndexKnown=o),this.lastRowIndexKnown||this.rowCount%this.params.blockSize==0&&this.rowCount++,this.onCacheUpdated()},r.prototype.forEachNodeDeep=function(t){var e=this,o=new s;this.getBlocksInOrder().forEach((function(r){return r.forEachNode(t,o,e.rowCount)}))},r.prototype.getBlocksInOrder=function(){return t.getAllValuesInObject(this.blocks).sort((function(t,e){return t.getId()-e.getId()}))},r.prototype.destroyBlock=function(t){delete this.blocks[t.getId()],this.destroyBean(t),this.blockCount--,this.params.rowNodeBlockLoader.removeBlock(t)},r.prototype.onCacheUpdated=function(){if(this.isAlive()){this.destroyAllBlocksPastVirtualRowCount();var t={type:a.EVENT_STORE_UPDATED};this.eventService.dispatchEvent(t)}},r.prototype.destroyAllBlocksPastVirtualRowCount=function(){var t=this,e=[];this.getBlocksInOrder().forEach((function(o){o.getId()*t.params.blockSize>=t.rowCount&&e.push(o)})),e.length>0&&e.forEach((function(e){return t.destroyBlock(e)}))},r.prototype.purgeCache=function(){var t=this;this.getBlocksInOrder().forEach((function(e){return t.removeBlockFromCache(e)})),this.lastRowIndexKnown=!1,0===this.rowCount&&(this.rowCount=this.params.initialRowCount),this.onCacheUpdated()},r.prototype.getRowNodesInRange=function(e,o){var r=this,n=[],i=-1,a=!1,c=new s;t.missing(e)&&(a=!0);var h=!1;return this.getBlocksInOrder().forEach((function(t){h||(a&&i+1!==t.getId()?h=!0:(i=t.getId(),t.forEachNode((function(t){var r=t===e||t===o;(a||r)&&n.push(t),r&&(a=!a)}),c,r.rowCount)))})),h||a?[]:n},r.MAX_EMPTY_BLOCKS_TO_KEEP=2,C([o("rowRenderer")],r.prototype,"rowRenderer",void 0),C([o("focusService")],r.prototype,"focusService",void 0),C([R(0,c("loggerFactory"))],r.prototype,"setBeans",null),C([n],r.prototype,"destroyAllBlocks",null),r}(h),I=function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function r(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(r.prototype=o.prototype,new r)}}(),E=function(t,e,o,r){var n,i=arguments.length,s=i<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,o):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,o,r);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(s=(i<3?n(s):i>3?n(e,o,s):n(e,o))||s);return i>3&&s&&Object.defineProperty(e,o,s),s},k=function(e){function i(){return null!==e&&e.apply(this,arguments)||this}return I(i,e),i.prototype.getRowBounds=function(t){return{rowHeight:this.rowHeight,rowTop:this.rowHeight*t}},i.prototype.ensureRowHeightsValid=function(t,e,o,r){return!1},i.prototype.init=function(){var t=this;this.gridOptionsWrapper.isRowModelInfinite()&&(this.rowHeight=this.gridOptionsWrapper.getRowHeightAsNumber(),this.addEventListeners(),this.addDestroyFunc((function(){return t.destroyCache()})),this.verifyProps())},i.prototype.verifyProps=function(){if(null!=this.gridOptionsWrapper.getInitialGroupOrderComparator()){t.doOnce((function(){return console.warn("AG Grid: initialGroupOrderComparator cannot be used with Infinite Row Model. If using Infinite Row Model, then sorting is done on the server side, nothing to do with the client.")}),"IRM.InitialGroupOrderComparator")}},i.prototype.start=function(){this.setDatasource(this.gridOptionsWrapper.getDatasource())},i.prototype.destroyDatasource=function(){this.datasource&&(this.getContext().destroyBean(this.datasource),this.rowRenderer.datasourceChanged(),this.datasource=null)},i.prototype.addEventListeners=function(){this.addManagedListener(this.eventService,a.EVENT_FILTER_CHANGED,this.onFilterChanged.bind(this)),this.addManagedListener(this.eventService,a.EVENT_SORT_CHANGED,this.onSortChanged.bind(this)),this.addManagedListener(this.eventService,a.EVENT_NEW_COLUMNS_LOADED,this.onColumnEverything.bind(this)),this.addManagedListener(this.eventService,a.EVENT_STORE_UPDATED,this.onCacheUpdated.bind(this))},i.prototype.onFilterChanged=function(){this.reset()},i.prototype.onSortChanged=function(){this.reset()},i.prototype.onColumnEverything=function(){(!this.cacheParams||this.isSortModelDifferent())&&this.reset()},i.prototype.isSortModelDifferent=function(){return!t.jsonEquals(this.cacheParams.sortModel,this.sortController.getSortModel())},i.prototype.getType=function(){return p.ROW_MODEL_TYPE_INFINITE},i.prototype.setDatasource=function(t){this.destroyDatasource(),this.datasource=t,t&&this.reset()},i.prototype.isEmpty=function(){return!this.infiniteCache},i.prototype.isRowsToRender=function(){return!!this.infiniteCache},i.prototype.getNodesInRangeForSelection=function(t,e){return this.infiniteCache?this.infiniteCache.getRowNodesInRange(t,e):[]},i.prototype.reset=function(){if(this.datasource){null!=this.gridOptionsWrapper.getRowIdFunc()||this.selectionService.reset(),this.resetCache();var t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)}},i.prototype.createModelUpdatedEvent=function(){return{type:a.EVENT_MODEL_UPDATED,api:this.gridApi,columnApi:this.columnApi,newPage:!1,newData:!1,keepRenderedRows:!0,animate:!1}},i.prototype.resetCache=function(){this.destroyCache(),this.cacheParams={datasource:this.datasource,filterModel:this.filterManager.getFilterModel(),sortModel:this.sortController.getSortModel(),rowNodeBlockLoader:this.rowNodeBlockLoader,initialRowCount:this.defaultIfInvalid(this.gridOptionsWrapper.getInfiniteInitialRowCount(),1),maxBlocksInCache:this.gridOptionsWrapper.getMaxBlocksInCache(),rowHeight:this.gridOptionsWrapper.getRowHeightAsNumber(),overflowSize:this.defaultIfInvalid(this.gridOptionsWrapper.getCacheOverflowSize(),1),blockSize:this.defaultIfInvalid(this.gridOptionsWrapper.getCacheBlockSize(),100),lastAccessedSequence:new s},this.infiniteCache=this.createBean(new v(this.cacheParams))},i.prototype.defaultIfInvalid=function(t,e){return t>0?t:e},i.prototype.destroyCache=function(){this.infiniteCache&&(this.infiniteCache=this.destroyBean(this.infiniteCache))},i.prototype.onCacheUpdated=function(){var t=this.createModelUpdatedEvent();this.eventService.dispatchEvent(t)},i.prototype.getRow=function(t){if(this.infiniteCache&&!(t>=this.infiniteCache.getRowCount()))return this.infiniteCache.getRow(t)},i.prototype.getRowNode=function(t){var e;return this.forEachNode((function(o){o.id===t&&(e=o)})),e},i.prototype.forEachNode=function(t){this.infiniteCache&&this.infiniteCache.forEachNodeDeep(t)},i.prototype.getTopLevelRowCount=function(){return this.getRowCount()},i.prototype.getTopLevelRowDisplayedIndex=function(t){return t},i.prototype.getRowIndexAtPixel=function(t){if(0!==this.rowHeight){var e=Math.floor(t/this.rowHeight),o=this.getRowCount()-1;return e>o?o:e}return 0},i.prototype.getRowCount=function(){return this.infiniteCache?this.infiniteCache.getRowCount():0},i.prototype.isRowPresent=function(t){return!!this.getRowNode(t.id)},i.prototype.refreshCache=function(){this.infiniteCache&&this.infiniteCache.refreshCache()},i.prototype.purgeCache=function(){this.infiniteCache&&this.infiniteCache.purgeCache()},i.prototype.isLastRowIndexKnown=function(){return!!this.infiniteCache&&this.infiniteCache.isLastRowIndexKnown()},i.prototype.setRowCount=function(t,e){this.infiniteCache&&this.infiniteCache.setRowCount(t,e)},E([o("filterManager")],i.prototype,"filterManager",void 0),E([o("sortController")],i.prototype,"sortController",void 0),E([o("selectionService")],i.prototype,"selectionService",void 0),E([o("gridApi")],i.prototype,"gridApi",void 0),E([o("columnApi")],i.prototype,"columnApi",void 0),E([o("rowRenderer")],i.prototype,"rowRenderer",void 0),E([o("rowNodeBlockLoader")],i.prototype,"rowNodeBlockLoader",void 0),E([r],i.prototype,"init",null),E([n],i.prototype,"destroyDatasource",null),i=E([u("rowModel")],i)}(h),m={moduleName:d.InfiniteRowModelModule,rowModels:{infinite:k}};export{m as InfiniteRowModelModule};
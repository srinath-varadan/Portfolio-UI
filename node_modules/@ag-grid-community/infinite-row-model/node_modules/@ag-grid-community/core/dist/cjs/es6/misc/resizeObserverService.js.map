{"version":3,"sources":["../../../src/ts/misc/resizeObserverService.ts"],"names":[],"mappings":"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","file":"resizeObserverService.js","sourcesContent":["import { Bean } from \"../context/context\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { debounce } from \"../utils/function\";\nimport { offsetHeight, offsetWidth } from \"../utils/dom\";\n\nconst DEBOUNCE_DELAY = 50;\n@Bean('resizeObserverService')\nexport class ResizeObserverService extends BeanStub {\n\n    private polyfillFunctions: (() => void)[] = [];\n    private polyfillScheduled: boolean;\n\n    public observeResize(element: HTMLElement, callback: () => void): () => void {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const win = (eDocument.defaultView || window) as any;\n        // this gets fired too often and might cause some relayout issues\n        // so we add a debounce to the callback here to avoid the flashing effect.\n        const debouncedCallback = debounce(callback, DEBOUNCE_DELAY);\n        const useBrowserResizeObserver = () => {\n\n            const resizeObserver = new win.ResizeObserver(debouncedCallback);\n            resizeObserver.observe(element);\n            return () => resizeObserver.disconnect();\n        };\n\n        const usePolyfill = () => {\n\n            // initialise to the current width and height, so first call will have no changes\n            let widthLastTime = offsetWidth(element);\n            let heightLastTime = offsetHeight(element);\n\n            // when finished, this gets turned to false.\n            let running = true;\n\n            const periodicallyCheckWidthAndHeight = () => {\n                if (running) {\n\n                    const newWidth = offsetWidth(element);\n                    const newHeight = offsetHeight(element);\n\n                    const changed = newWidth !== widthLastTime || newHeight !== heightLastTime;\n                    if (changed) {\n                        widthLastTime = newWidth;\n                        heightLastTime = newHeight;\n                        callback();\n                    }\n\n                    this.doNextPolyfillTurn(periodicallyCheckWidthAndHeight);\n                }\n            };\n\n            periodicallyCheckWidthAndHeight();\n\n            // the callback function we return sets running to false\n            return () => running = false;\n        };\n\n        const suppressResize = this.gridOptionsWrapper.isSuppressBrowserResizeObserver();\n        const resizeObserverExists = !!win.ResizeObserver;\n\n        if (resizeObserverExists && !suppressResize) {\n            return useBrowserResizeObserver();\n        }\n\n        return usePolyfill();\n    }\n\n    private doNextPolyfillTurn(func: () => void): void {\n        this.polyfillFunctions.push(func);\n        this.schedulePolyfill();\n    }\n\n    private schedulePolyfill(): void {\n        if (this.polyfillScheduled) { return; }\n\n        const executeAllFuncs = () => {\n            const funcs = this.polyfillFunctions;\n\n            // make sure set scheduled to false and clear clear array\n            // before executing the funcs, as the funcs could add more funcs\n            this.polyfillScheduled = false;\n            this.polyfillFunctions = [];\n\n            funcs.forEach(f => f());\n        };\n\n        this.polyfillScheduled = true;\n        this.getFrameworkOverrides().setTimeout(executeAllFuncs, DEBOUNCE_DELAY);\n    }\n\n}\n"]}
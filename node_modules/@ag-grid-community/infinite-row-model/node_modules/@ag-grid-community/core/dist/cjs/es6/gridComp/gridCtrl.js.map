{"version":3,"sources":["../../../src/ts/gridComp/gridCtrl.ts"],"names":[],"mappings":"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","file":"gridCtrl.js","sourcesContent":["import { Autowired, PostConstruct } from \"../context/context\";\nimport { GridApi } from \"../gridApi\";\nimport { FocusService } from \"../focusService\";\nimport { BeanStub } from \"../context/beanStub\";\nimport { ModuleRegistry } from \"../modules/moduleRegistry\";\nimport { ModuleNames } from \"../modules/moduleNames\";\nimport { LayoutFeature, LayoutView } from \"../styling/layoutFeature\";\nimport { Events } from \"../eventKeys\";\nimport { ResizeObserverService } from \"../misc/resizeObserverService\";\nimport { GridSizeChangedEvent } from \"../events\";\nimport { ColumnApi } from \"../columns/columnApi\";\nimport { ColumnModel } from \"../columns/columnModel\";\nimport { CtrlsService } from \"../ctrlsService\";\nimport { MouseEventService } from \"../gridBodyComp/mouseEventService\";\nimport { last } from \"../utils/array\";\n\nexport interface IGridComp extends LayoutView {\n    setRtlClass(cssClass: string): void;\n    destroyGridUi(): void;\n    forceFocusOutOfContainer(up: boolean): void;\n    addOrRemoveKeyboardFocusClass(value: boolean): void;\n    getFocusableContainers(): HTMLElement[];\n    setCursor(value: string | null): void;\n    setUserSelect(value: string | null): void;\n}\n\nexport class GridCtrl extends BeanStub {\n\n    @Autowired('columnApi') private readonly columnApi: ColumnApi;\n    @Autowired('gridApi') private readonly gridApi: GridApi;\n    @Autowired('focusService') protected readonly focusService: FocusService;\n    @Autowired('resizeObserverService') private readonly resizeObserverService: ResizeObserverService;\n    @Autowired('columnModel') private readonly columnModel: ColumnModel;\n    @Autowired('ctrlsService') private readonly ctrlsService: CtrlsService;\n    @Autowired('mouseEventService') private readonly mouseEventService: MouseEventService;\n\n    private view: IGridComp;\n    private eGridHostDiv: HTMLElement;\n    private eGui: HTMLElement;\n\n    public setComp(view: IGridComp, eGridDiv: HTMLElement, eGui: HTMLElement): void {\n        this.view = view;\n        this.eGridHostDiv = eGridDiv;\n        this.eGui = eGui;\n\n        this.mouseEventService.stampTopLevelGridCompWithGridInstance(eGridDiv);\n\n        this.createManagedBean(new LayoutFeature(this.view));\n\n        // important to set rtl before doLayout, as setting the RTL class impacts the scroll position,\n        // which doLayout indirectly depends on\n        this.addRtlSupport();\n\n        this.addManagedListener(this, Events.EVENT_KEYBOARD_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(true);\n        });\n\n        this.addManagedListener(this, Events.EVENT_MOUSE_FOCUS, () => {\n            this.view.addOrRemoveKeyboardFocusClass(false);\n        });\n\n        const unsubscribeFromResize = this.resizeObserverService.observeResize(\n            this.eGridHostDiv, this.onGridSizeChanged.bind(this));\n        this.addDestroyFunc(() => unsubscribeFromResize());\n\n        this.ctrlsService.registerGridCtrl(this);\n    }\n\n    public isDetailGrid(): boolean {\n        const el = this.focusService.findTabbableParent(this.getGui());\n\n        return el?.getAttribute('row-id')?.startsWith('detail') || false;\n    }\n\n    public showDropZones(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.RowGroupingModule);\n    }\n\n    public showSideBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.SideBarModule);\n    }\n\n    public showStatusBar(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.StatusBarModule);\n    }\n\n    public showWatermark(): boolean {\n        return ModuleRegistry.isRegistered(ModuleNames.EnterpriseCoreModule);\n    }\n\n    private onGridSizeChanged(): void {\n        const event: GridSizeChangedEvent = {\n            type: Events.EVENT_GRID_SIZE_CHANGED,\n            api: this.gridApi,\n            columnApi: this.columnApi,\n            clientWidth: this.eGridHostDiv.clientWidth,\n            clientHeight: this.eGridHostDiv.clientHeight\n        };\n        this.eventService.dispatchEvent(event);\n    }\n\n    private addRtlSupport(): void {\n        const cssClass = this.gridOptionsWrapper.isEnableRtl() ? 'ag-rtl' : 'ag-ltr';\n        this.view.setRtlClass(cssClass);\n    }\n\n    public destroyGridUi(): void {\n        this.view.destroyGridUi();\n    }\n\n    public getGui(): HTMLElement {\n        return this.eGui;\n    }\n\n    public setResizeCursor(on: boolean): void {\n        this.view.setCursor(on ? 'ew-resize' : null);\n    }\n\n    public disableUserSelect(on: boolean): void {\n        this.view.setUserSelect(on ? 'none' : null);\n    }\n\n    public focusNextInnerContainer(backwards: boolean): boolean {\n        const eDocument = this.gridOptionsWrapper.getDocument();\n        const focusableContainers = this.view.getFocusableContainers();\n        const idxWithFocus = focusableContainers.findIndex(container => container.contains(eDocument.activeElement));\n        const nextIdx = idxWithFocus + (backwards ? -1 : 1);\n\n        if (nextIdx <= 0 || nextIdx >= focusableContainers.length) {\n            return false;\n        }\n\n        return this.focusService.focusInto(focusableContainers[nextIdx]);\n    }\n\n    public focusInnerElement(fromBottom?: boolean) {\n        const focusableContainers = this.view.getFocusableContainers();\n\n        if (fromBottom) {\n            if (focusableContainers.length > 1) {\n                return this.focusService.focusInto(last(focusableContainers), true);\n            }\n\n            const lastColumn = last(this.columnModel.getAllDisplayedColumns());\n            if (this.focusService.focusGridView(lastColumn, true)) { return true; }\n        }\n\n        return this.focusService.focusFirstHeader();\n    }\n\n    public forceFocusOutOfContainer(up = false): void {\n        this.view.forceFocusOutOfContainer(up);\n    }\n\n}"]}